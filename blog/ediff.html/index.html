<!DOCTYPE html>
<html lang="zh">
  <head>
    <title>Windows 下使用Emacs的 Ediff 进行文件的比较、合并 - 拾遗笔记</title>
    <meta charset="utf-8" />
    <meta name="author" content="纪秀峰" />
    <meta name="description" content="" />
    <meta name="keywords" content="ediff Emacs windows exe" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <!-- <link rel="stylesheet" href="/media/css/prettify.css" type="text/css"> -->
  </head>
  <body class="container">
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- ji -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6633117582073327"
     data-ad-slot="1629980291"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">拾遗笔记</a></h1>
        <p></p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="http://github.com/jixiuf">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="jixiuf.github.io">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>Windows 下使用Emacs的 Ediff 进行文件的比较、合并</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4d8339a">link 关于几种diff tool 的比较 KDiff3, Diffuse, and VimDiff  Meld Emacs-Ediff(有图有真相)</a></li>
<li><a href="#orgb113bf6">一些配置</a></li>
</ul>
</div>
</div>

<div id="outline-container-org4d8339a" class="outline-2">
<h2 id="org4d8339a">link 关于几种diff tool 的比较 KDiff3, Diffuse, and VimDiff  Meld Emacs-Ediff(有图有真相)</h2>
<div class="outline-text-2" id="text-org4d8339a">
<p>
<a href="http://rvb.mytanet.de/comparing-latex-files-with-latexdiff.shtml">http://rvb.mytanet.de/comparing-latex-files-with-latexdiff.shtml</a> (此链接已失效)<br />
以下几张图 可以显示出 几种diff tool 在比较时的不同，可以明显看出 ediff 能够清<br />
晰的显示 添加了什么，修改了什么，而其他几种工具， 简直一团糟<br />
<img src="/assets/blog/ediff.html/ediff.png" alt="ediff.png" /><br />
<img src="/assets/blog/ediff.html/meld.png" alt="meld.png" /><br />
<img src="/assets/blog/ediff.html/vimdiff.png" alt="vimdiff.png" /><br />
<img src="/assets/blog/ediff.html/diffuse.png" alt="diffuse.png" /><br />
<img src="/assets/blog/ediff.html/kdiff3.png" alt="kdiff3.png" /><br />
</p>
</div>
</div>

<div id="outline-container-orgb113bf6" class="outline-2">
<h2 id="orgb113bf6">一些配置</h2>
<div class="outline-text-2" id="text-orgb113bf6">
<p>
值得一提的一点Emacs中的ediff进行文件比较及合并的工具,<br />
</p>
<div class="org-src-container">
<pre class="src src-sh">emacsclientw -eval <span style="color: #ffa07a;">"(ediff-files \"&#25991;&#20214;1.txt\" \"&#25991;&#20214;2.txt\")"</span>
<span style="color: #AEAEAE;"># </span><span style="color: #AEAEAE;">&#36825;&#20010;&#27979;&#35797;&#20102;&#19968;&#19979;&#22909;&#20687;&#19981;&#34892;&#65292;&#25253;&#25214;&#19981;&#30528;&#25991;&#20214;1.txt&#30340;&#38169;</span>
emacs -eval <span style="color: #ffa07a;">"(ediff-files \"&#25991;&#20214;1.txt\" \"&#25991;&#20214;2.txt\")"</span>
</pre>
</div>
<p>
这样就可以对文件1.txt 文件2.txt进行比较了不过要让它与其他工具进行集成,还真有点麻烦.<br />
1是路径文件 对d:\asd\1sda\a.txt这样的路径它不理解d:/asd/1sda/a.txt它理解 .<br />
但与其他工具进行集成的时候,它是不知道该用"/"而不是"\"<br />
<a href="http://www.emacswiki.org/emacs/EdiffOnWThirtyTwo">EdiffOnEmacsWiki</a> 上找到<br />
这样一段程序，它使用gcc 编译之后生成一个程序，这个程序接收两个参数，即两个文件名<br />
然后emacs就会调用ediff 对这文件进行比较<br />
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #7fffd4;">#include</span> <span style="color: #ffa07a;">&lt;stdio.h&gt;</span>
<span style="color: #7fffd4;">#include</span> <span style="color: #ffa07a;">&lt;stdlib.h&gt;</span>

<span style="color: #AEAEAE;">/*</span>
<span style="color: #AEAEAE;"> * call-ediff is used to call ediff from Perforce.</span>
<span style="color: #AEAEAE;"> * gcc -o call-ediff call-ediff.c &amp;&amp; call-ediff y:/Source/find_audio_xmls.sh y:/Source/find_audio_xmls.sh~</span>
<span style="color: #AEAEAE;"> */</span>

<span style="color: #8DA6CE;">void</span> <span style="color: #FF6400;">hackPathSeparator</span>(<span style="color: #8DA6CE;">char</span> *<span style="color: #40E0D0;">windozePath</span>) {
    <span style="color: #8DA6CE;">char</span> *<span style="color: #40E0D0;">c</span>;

    <span style="color: #FBDE2D;">for</span> (c = windozePath; *c; c++) {
        <span style="color: #FBDE2D;">if</span> (<span style="color: #ffa07a;">'\\'</span> == *c)
            *c = <span style="color: #ffa07a;">'/'</span>;
    }
}

<span style="color: #8DA6CE;">int</span> <span style="color: #FF6400;">main</span>(<span style="color: #8DA6CE;">int</span> <span style="color: #40E0D0;">argc</span>, <span style="color: #8DA6CE;">char</span> *<span style="color: #40E0D0;">argv</span>[], <span style="color: #8DA6CE;">char</span> *<span style="color: #40E0D0;">envp</span>[]) {
    <span style="color: #8DA6CE;">char</span> *<span style="color: #40E0D0;">param1</span> = argv[1];
    <span style="color: #8DA6CE;">char</span> *<span style="color: #40E0D0;">param2</span> = argv[2];

    <span style="color: #AEAEAE;">/* </span><span style="color: #AEAEAE;">We get \ part separators from Perforce; hack these to /</span><span style="color: #AEAEAE;"> */</span>

    hackPathSeparator(param1);
    hackPathSeparator(param2);

    <span style="color: #AEAEAE;">/* </span><span style="color: #AEAEAE;">hack the arg list (ugh)</span><span style="color: #AEAEAE;"> */</span>

    argv[1] = <span style="color: #ffa07a;">"-e"</span>;
    <span style="color: #AEAEAE;">/* </span><span style="color: #AEAEAE;">Sample usage: argv[2] = "(progn (message \"foo\") (raise-frame))";</span><span style="color: #AEAEAE;"> */</span>

    <span style="color: #8DA6CE;">char</span> *<span style="color: #40E0D0;">command</span> = (<span style="color: #8DA6CE;">char</span> *)malloc(4096);
    sprintf(command, <span style="color: #ffa07a;">"(progn (raise-frame) (ediff \"%s\" \"%s\"))"</span>, param1, param2);

    argv[2] = command;

    execvp(<span style="color: #ffa07a;">"gnuclientw.exe"</span>, argv);
    <span style="color: #FBDE2D;">return</span> 0;
}


</pre>
</div>

<p>
将文件命名为call-ediff.c<br />
然后在Windows上的cygwin 或mingw上,用gcc进行编译,编译后生成的文件接收两个参数,两个文件名,它会自动将路径进行转换.<br />
</p>
<div class="org-src-container">
<pre class="src src-sh">gcc -Wl,--subsystem,windows -o call-ediff call-ediff.c
</pre>
</div>
<p>
不过有个问题我用emacsclient.exe 而不是gnuclientw.exe 所以编译前需要对代码进行一下修改<br />
我用cygwin下的gcc 编译了生成了三个文件,分别是用<br />
runemacs.exe emacsclientw.exe gnuclientw.exe<br />
运行(ediff)函数的结果 ，不过要想使用它们，你得安装cygwin<br />
<a href="/assets/blog/ediff.html/runemacs-ediff.exe">emacs-ediff.exe</a><br />
<a href="/assets/blog/ediff.html/emacsclientw-ediff.exe">emacsclientw-ediff.exe</a><br />
<a href="/assets/blog/ediff.html/gnuclientw-ediff.exe">gnuclinet-ediff.exe</a><br />
你可以直接下载使用使用它们,只需emacsclientw-ediff c:\a.txt c:\b.txt即可,不必担心路径的问题.<br />
</p>



<p>
但是用gcc 编译有个问题，那就是你必须有个gcc 编译器，且离了gcc编译器后这个程序就没用了<br />
我试图用VC 编译它，发现编译不了，做了一些修改，修改后的内容如下<br />
修改后，我是调用 emacsclientw.exe 来调用 ediff 的，所以你必须配置好让 emacs 启动server<br />
关于emacsclient 的另一篇文章在<a href="emacs-on-windows.html">这里</a> 有介绍。<br />
有这样一段程序<br />
</p>
<div class="org-src-container">
<pre class="src src-sh">//start here.
<span style="color: #AEAEAE;">#</span><span style="color: #AEAEAE;">include &lt;stdio.h&gt;</span>
<span style="color: #AEAEAE;">#</span><span style="color: #AEAEAE;">include &lt;stdlib.h&gt;</span>

/*
 * call-ediff is used to call ediff from Perforce.
 *  call-ediff c:\a\b\a.txt c:\a\b\b.txt
 *  or
 *  call-ediff c:/a/b/a.txt :/a/b/b.txt
 */

void hackPathSeparator(char *windozePath) {
  char *c;

  <span style="color: #FBDE2D;">for</span> (c = windozePath; *c; c++) {
        <span style="color: #FBDE2D;">if</span> (<span style="color: #ffa07a;">'\\'</span> == *c)
      *c = <span style="color: #ffa07a;">'/'</span>;
  }
}

int main(int argc, char *argv[], char *envp[]) {
  char *param1 = argv[1];
  char *param2 = argv[2];
  char *command;
  /* We get <span style="color: #ffa07a;">\ </span>part separators from Perforce; hack these to / */

  hackPathSeparator(param1);
  hackPathSeparator(param2);


  /* /<span style="color: #ffa07a;">\*</span> hack the arg list (ugh) *<span style="color: #ffa07a;">\/</span> */
  <span style="color: #40E0D0;">command</span>= (char*) malloc(4096);

   sprintf(command, <span style="color: #ffa07a;">"emacsclientw -eval \"(progn (raise-frame) (ediff \\\"%s\\\" \\\"%s\\\"))\""</span>, param1, param2);
   system( command);
  <span style="color: #FBDE2D;">return</span> 0;
}
//ends here.
</pre>
</div>
<p>
用VC编译的<a href="/assets/blog/ediff.html/call-ediff-by-emacsclientw-compiled-by-vc.exe">run-ediff-compiled-by-vc.exe</a><br />
</p>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2011-06-04</span>
        <span title="last modification date" class="post-info">2021-09-10</span>
        <span title="tags" class="post-info"><a href="/tags/emacs/">Emacs</a>, <a href="/tags/windows/">Windows</a></span>
        <span title="author" class="post-info">纪秀峰</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/ediff.html";
          var disqus_url = "http://jixiuf.github.io/blog/ediff.html";
          var disqus_shortname = 'jixiuf';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <div class="ds-thread"></div>
        <script type="text/javascript">
          var duoshuoQuery = {short_name:'jixiuf'};
          (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = 'http://static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
        </script>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x (<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:jixiuf &lt;at&gt; gmail &lt;dot&gt; com">纪秀峰</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
