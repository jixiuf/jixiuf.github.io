<!DOCTYPE html>
<html lang="zh">
  <head>
    <title>erlang.org - 拾遗笔记</title>
    <meta charset="utf-8" />
    <meta name="author" content="纪秀峰" />
    <meta name="description" content="erlang.org" />
    <meta name="keywords" content="erlang" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <!-- <link rel="stylesheet" href="/media/css/prettify.css" type="text/css"> -->
  </head>
  <body class="container">
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- ji -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6633117582073327"
     data-ad-slot="1629980291"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">拾遗笔记</a></h1>
        <p></p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="http://github.com/jixiuf">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="jixiuf.github.io">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>erlang.org</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4537be9">用systool发布</a></li>
<li><a href="#orgda5d1e2">用reltool发布</a>
<ul>
<li><a href="#org8320f74">如何发布</a></li>
<li><a href="#orgf32827b">reltool 使用的配置文件的格式</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org4537be9" class="outline-2">
<h2 id="org4537be9">用systool发布</h2>
<div class="outline-text-2" id="text-org4537be9">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #F8F8F8;">cd</span> erlcount_release/
erl -env ERL_LIBS  .
</pre>
</div>

<p>
erlcount-1.0.rel<br />
</p>
<div class="org-src-container">
<pre class="src src-erlang">{release,
 {"erlcount" ,"1.0.0"},
 {erts, "5.8.5"},
 [ {kernel ,"2.14.5"},
   {stdlib,"1.17.5"},
   {ppool,"1.1.0",permanent},
   {erlcount,"1.0.0",transient}
 ]
}.                    %最后一个点不能少。
%% 相应 的版本号可以通过 erl 命令后，会显示当前 Eshell V5.8.5  (abort with ^G)
%% application:which_applications(). 结果是：
%% [{stdlib,"ERTS  CXC 138 10","1.17.5"},
%%  {kernel,"ERTS  CXC 138 10","2.14.5"}]

%% systools:make_script("erlcount-1.0",[local]). 通过此文件生成启动脚本boot

%% the local option means that we want the release to be possible to run from
%% anywhere, and not just the current install.

%% systools:make_tar("erlcount-1.0" ,[{erts, "d:/usr/erl5.8.5/"}]).
%% 生成tar
</pre>
</div>
<p>
%% systools:make_script("erlcount-1.0",[local]). 通过 erlcount-1.0.rel  生成启动脚本boot<br />
%% the local option means that we want the release to be possible to run from<br />
%% anywhere, and not just the current install.<br />
</p>

<p>
生成的脚本名称如<br />
erlcount-1.0.script<br />
erlcount-1.0.boot<br />
</p>

<p>
systools:make_tar("erlcount-1.0" ,[{erts, "d:/usr/erl5.8.5/"}]).<br />
%% 生成 tar.gz<br />
   解压开后的目录如<br />
  drwxrwxrwx  1 jixf       0 12-15 11:06 erts-5.8.5<br />
  drwxrwxrwx  1 jixf       0 12-15 11:06 lib<br />
  drwxrwxrwx  1 jixf       0 12-15 11:06 releases<br />
  ;;<br />
</p>

<p>
通过 ./erts-5.8.8/bin/erl -boot releases/1.0.0/start可以执行.<br />
可以通过以下方式向 erlcount 传递 directory 参数。<br />
./erts-5.8.4/bin/erl -boot releases/1.0.0/start -erlcount directory '"<i>home/ferd/code/otp_src_R14B03</i>"' -noshell<br />
注意单双引号<br />
</p>
</div>
</div>

<div id="outline-container-orgda5d1e2" class="outline-2">
<h2 id="orgda5d1e2">用reltool发布</h2>
<div class="outline-text-2" id="text-orgda5d1e2">
</div>
<div id="outline-container-org8320f74" class="outline-3">
<h3 id="org8320f74">如何发布</h3>
<div class="outline-text-3" id="text-org8320f74">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #F8F8F8;">cd</span> release
mkdir rel
</pre>
</div>
<p>
用到release/erlcount-1.0.config作为配置文件<br />
</p>
<div class="org-src-container">
<pre class="src src-erlang">{ok, Conf} = file:consult("erlcount-1.0.config").
{ok, Spec} = reltool:get_target_spec(Conf).
reltool:eval_target_spec(Spec, code:root_dir(), "rel"). % 在rel 目录内生成相
应的内容
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #F8F8F8;">cd</span> rel
./bin -noshell
./bin -noshell -erlcount directory <span style="color: #ffa07a;">' "/home/jixiuf/documents/erlang/erlcount_release/"'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf32827b" class="outline-3">
<h3 id="orgf32827b">reltool 使用的配置文件的格式</h3>
<div class="outline-text-3" id="text-orgf32827b">
<p>
其可配置的Options 是分层的，分别是release 层,app层， 及module层<br />
分别对应 sys ,app ,mode 三个key  ,sys 配置全局属性，app可以覆盖sys 中配置的<br />
属性，仿佛子承父类，<br />
{sys, [Options]},<br />
{app, Appname [Options]}<br />
{mod,&#x2026;}<br />
</p>
</div>

<ul class="org-ul">
<li><a id="org7fac66c"></a>{sys,[Options]}<br />
<ul class="org-ul">
<li><a id="org33368a4"></a>erts<br />
<div class="outline-text-5" id="text-org33368a4">
<p>
指定 erts application 信息, 具体的字段参考后面介绍的 app 配置.<br />
</p>
</div>
</li>
<li><a id="orgac6d285"></a>escript<br />
<div class="outline-text-5" id="text-orgac6d285">
<p>
escript 脚本配置信息, 包含 escript 文件,以及对应的配置信息<br />
</p>
</div>
</li>
<li><a id="org5c7d79d"></a>app<br />
<div class="outline-text-5" id="text-org5c7d79d">
<p>
     target system 中包含的 app 信息. 比如所有的 release 都要包含 kernel,<br />
stdlib, 具体的app的相关配置,轻参考后面介绍的 app level 配置<br />
</p>
</div>
</li>

<li><a id="orge8cac41"></a>mod_cond<br />
<div class="outline-text-5" id="text-orge8cac41">
<p>
设置 module 的包含策略. 此处配置的 mod_cond 是 sys level 的配置, 控制所有的<br />
app 中的 module 包含策略. 当然我们可以对这个信息, 在 app level 进行覆盖. 其包含<br />
多种方式:<br />
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">all</td>
<td class="org-left">表示如果某个 app 被包含,那么其包含的所有模块全部被包含. 假设 app 名为 demoapp, all 不仅包含 demoapp/ebin 下的所有模块, 同时 demoapp.app 中 modules 字段描述的所有模块也将被包括(默认)</td>
</tr>

<tr>
<td class="org-left">ebin</td>
<td class="org-left">表示 ebin 目录下所有的模块,以及相关的模块会被包含</td>
</tr>

<tr>
<td class="org-left">app</td>
<td class="org-left">表示 .app 描述文件,以及相关的模块会被包含</td>
</tr>

<tr>
<td class="org-left">derived</td>
<td class="org-left">表示被其他包含的模块用到的相关模块会被包含</td>
</tr>
</tbody>
</table>
<p>
****|incl_cond 设置 applicaion 以及 escript 的包含策略.<br />
其包|3种类型:<br />
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">derived</td>
<td class="org-left">表示 包含 没有明确设置 incl_cond, 同时被其他 application 直接或间接引用的application. (默认)</td>
</tr>

<tr>
<td class="org-left">include</td>
<td class="org-left">表示 包含 所有没有明确设置 incl_cond 的application</td>
</tr>

<tr>
<td class="org-left">exclude</td>
<td class="org-left">表示 排除 排除没有明确设置 incl_cond 的application</td>
</tr>
</tbody>
</table>
<p>
include 和 exclude 意义相反. 一个是包含没有设置 incl_cond 的 apps, 一个是排除没<br />
有设置 incl_cond 的 apps. 一般我们使用默认的 derived 选项,这样保证所有相关的<br />
application 均被包含, 不会出现 target system 中,某个模块没有定义的错误.我们可以<br />
通过前面 reltool GUI 部分介绍的 application 依赖关系图 来了解 application 的交<br />
互相关信息.<br />
</p>
</div>
</li>

<li><a id="org3ec9660"></a>boot_rel<br />
<div class="outline-text-5" id="text-org3ec9660">
<p>
指定 target system 中默认启动项 (rel), 一个target system 中可能包含很多的<br />
release(通过 rel 来指定)<br />
</p>
</div>
</li>
<li><a id="org1cc1735"></a>rel<br />
<div class="outline-text-5" id="text-org1cc1735">
<p>
指定 rel 内容 <a href="http://www.erlang.org/doc/design_principles/release_structure.html#10">(Release specific configuration)</a> , 每个 rel 定义会被映射成 rel,<br />
script 和 boot 文件,请参考 Erlang/OTP Design Principles Release<br />
</p>
</div>
</li>
<li><a id="orgb68aa9e"></a>relocable<br />
<div class="outline-text-5" id="text-orgb68aa9e">
<p>
指定 target system 中erl 执行时自动检测路径相关信息({relocable, true}), 还是硬<br />
编码指定路径启动({relocable, false}). 如果 relocable 为 false, 那么 target<br />
system 必须首先通过 reltool:install/2 进行安装, 如果 relocable 为 true, target<br />
system 移动到其他目录时,仍然可以方便的运行. {relocable, true} (默认)<br />
</p>
</div>
</li>
<li><a id="org0ca40c6"></a>profile<br />
<div class="outline-text-5" id="text-org0ca40c6">
<p>
指定 tareget system 的类型, 此选项主要影响:incl_sys_filters,<br />
excl_sys_filters, incl_app_filters 和 excl_app_filters. 不同的 profile 类<br />
型, 以上4个 filters 不同.<br />
主要包含3种:<br />
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">development</td>
<td class="org-left">开发测试模式(默认)</td>
</tr>

<tr>
<td class="org-left">embedded</td>
<td class="org-left">嵌入式完整模式</td>
</tr>

<tr>
<td class="org-left">standalone</td>
<td class="org-left">单独模式,不携带相关的可执行文件</td>
</tr>
</tbody>
</table>
<p>
在生成 target system 时, 实际上主要有两个步骤:首先创建一个完整的文件候选列<br />
表,它包含尽可能多的文件; 随后调用各种相关的 filter 定义,对结果进行过滤, 最<br />
后声称最终的 target system. 一般情况下,我们的target system 要是一个完整的<br />
可执行的系统,因此我们许要设置 profile 为 embedded. (当然不设置 profile, 只<br />
是修改4个相关的 filter, 也可以达到我们想要的效果)<br />
</p>
</div>
</li>

<li><a id="orge5e4576"></a>app_file<br />
<div class="outline-text-5" id="text-orge5e4576">
<p>
控制 app 的内容, 因为有各种各样的 filter, 因此最终的 target system 中包含<br />
的模块,可能与 app 文件定义的模块列表不一致, 本选项控制 app 的内容. 主要包<br />
含3种:<br />
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">keep</td>
<td class="org-left">将 app 直接拷贝到 target system 中(默认)</td>
</tr>

<tr>
<td class="org-left">strip</td>
<td class="org-left">依据 app 文件产生 target system 中的 app 文件, 并将未被包含的模块从 app 文件中移出</td>
</tr>

<tr>
<td class="org-left">all</td>
<td class="org-left">依据 app 文件产生 tarege system 中的 app 文件, 同时所有的模块将添加到 app 文件中, 如果某个应用没有 app 文件,那么会自动创建一个 app 文件.</td>
</tr>
</tbody>
</table>
</div>
</li>


<li><a id="orge63bc39"></a>debug_info<br />
<div class="outline-text-5" id="text-orge63bc39">
<p>
是否去除 beam 文件中的调试信息: keep 表示保持; strip 表示去除<br />
</p>
</div>
</li>
<li><a id="org405187d"></a>incl_sys_filters<br />
<div class="outline-text-5" id="text-org405187d">
<p>
指定一个正则表达式列表,用来表示哪些系统文件可以出现在 target system 中. 如果某<br />
个系统文件想被包括, 那么其必须满足 incl_sys_filters 中的某个正则表达式, 同时不<br />
能满足 excl_sys_filters 中的任何表达式.<br />
比如:<br />
{incl_sys_filters,["^bin","^erts","^lib","^releases"]},<br />
表示 $ERL_ROOT 目录下的 bin, erts, lib, releases 目录均要包含.<br />
incl_app_filters, excl_app_filters 同 sys 相关的 filters 含义大致相同,只是用来控制 application 的包含规则.<br />
</p>
</div>
</li>
<li><a id="org44a62c2"></a>excl_sys_filters<br />
<div class="outline-text-5" id="text-org44a62c2">
<p>
指定一个正则表达式列表,表示哪些系统文件不可以出现在 target system 中. 默认 为<br />
[].<br />
</p>
</div>
</li>
<li><a id="org88a052e"></a>incl_app_filters<br />
<div class="outline-text-5" id="text-org88a052e">
<p>
指定一个正则表达式列表,表示 application 中的哪些文件可以被包含. 如果某个文件想<br />
被包含,至少要满足正则表达式列表中的一个表达式. 默认为 [".*"], 如果设置为 [], 那<br />
么 application 中的任何文件都不会被包含.<br />
</p>
</div>
</li>
<li><a id="orgf5841a1"></a>excl_app_filters<br />
<div class="outline-text-5" id="text-orgf5841a1">
<p>
指定一个正则表达式列表,表示 application 的哪些文件不可以出现在 target system 中. 默认 为 [].<br />
</p>
</div>
</li>

<li><a id="orgb1c001e"></a>incl_archive_filters<br />
<div class="outline-text-5" id="text-orgb1c001e">
<p>
指定 application 中哪些一级子目录包含在压缩包中(与包含正常的目录对应), 通<br />
过一个正则表达式列表指定要包含在压缩包中的一级子目录. 默认为 [".*"]<br />
</p>
</div>
</li>
<li><a id="org030b68f"></a>excl_archive_filters<br />
<div class="outline-text-5" id="text-org030b68f">
<p>
指定一个正则表达式列表,指定 application 的哪些一级目录不包含在压缩包中. 如<br />
果某个目录,匹配任何一个正则表达式,则不会包含在压缩包中. 默认为<br />
["^include\(", "^priv\)"]<br />
</p>
</div>
</li>
<li><a id="orgcceff04"></a>archive_opts<br />
<div class="outline-text-5" id="text-orgcceff04">
<p>
创建压缩包对应的参数,在 zip:create/3 中使用, 请参考 <a href="http://erlang.org/doc/man/zip.html">zip module</a>, 默认 为 [].<br />
</p>
</div>
</li>
</ul>
</li>

<li><a id="orgee5d292"></a>{app,AppName,[Options]}<br />
<ul class="org-ul">
<li><a id="org28783b6"></a>vsn<br />
<div class="outline-text-5" id="text-org28783b6">
<p>
指定要包含的 application 的版本, 因为在系统中,可能存在同一应用的多个版本. 如果忽略,则使用最新版本.<br />
</p>
</div>
</li>
<li><a id="org9dfa826"></a>mod<br />
<div class="outline-text-5" id="text-org9dfa826">
<p>
模块相关的配置信息. 必须包含一个模块名称,以及其他可选的模块配置(参照后面 mod 配置)<br />
</p>
</div>
</li>
<li><a id="orga57962e"></a>mod_cond - 同 sys level 的同名配置含义相同<br /></li>
<li><a id="org9ffcb06"></a>incl_cond - 同上<br /></li>
<li><a id="org71fe79f"></a>debug_info - 同上<br /></li>
<li><a id="orgf97a329"></a>incl_app_filters - 同上<br /></li>
<li><a id="org9cdaa0d"></a>excl_app_filters - 同上<br /></li>
<li><a id="org3124802"></a>incl_archive_filters - 同上<br /></li>
<li><a id="org0b440c9"></a>excl_archive_filters - 同上<br /></li>
<li><a id="orgbd8a690"></a>archive_opts - 同上<br /></li>
</ul>
</li>
<li><a id="org71d2e4c"></a>mod 配置<br />
<ul class="org-ul">
<li><a id="org5fbaf72"></a>incl_cond<br />
<div class="outline-text-5" id="text-org5fbaf72">
<p>
指示模块是否被包含,其覆盖 application 及 system 配置中的 incl_cond 信息.<br />
其包含3个值:<br />
include - 表示本模块将被包含<br />
exclude - 表示本模块不被包含<br />
derived - 表示如果其他被包含的模块引用本模块,则本模块被也被包含.<br />
</p>
</div>
</li>

<li><a id="orgd4f13d1"></a>debug_info<br />
<div class="outline-text-5" id="text-orgd4f13d1">
<p>
同 app 配置中 debug_info 描述.<br />
</p>
</div>
</li>
</ul>
</li>



<li><a id="org1721f21"></a>demo config<br />
<div class="outline-text-4" id="text-org1721f21">
<div class="org-src-container">
<pre class="src src-erlang">{sys,
   [
   {lib_dirs,["/home/jixiuf/erlang"]},
   {boot_rel, "erlips"},
   {rel, "erlips", "0.1", [kernel, stdlib, sasl, mochiweb, erlips]},
   {relocatable, true},
   {profile, embedded},
   {app_file, keep},
   {debug_info, strip},
   {mod_cond, all},
   {incl_cond, derived},

   {incl_app_filters, ["^include", "^priv", "^ebin", "^src"]},
   {excl_app_filters, []},

   {incl_archive_filters,[]},
   {excl_archive_filters,[".*"]},

   {app, kernel, [{incl_cond, include}]},
   {app, stdlib, [{incl_cond, include}]},
   {app, sasl, [{incl_cond, include}]},
   {app, erlips, [{incl_cond, include},
		   {incl_app_filters, [".*"]},
		   {excl_app_filters, ["^log", "^var", "^release"]}]},
   {app, mochiweb, [{incl_cond, include}]},
   {app, runtime_tools, [{incl_cond, include}]}
   ]
}.
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2011-11-20</span>
        <span title="last modification date" class="post-info">2021-09-10</span>
        <span title="tags" class="post-info"><a href="/tags/erlang/">Erlang</a></span>
        <span title="author" class="post-info">纪秀峰</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/release.html";
          var disqus_url = "http://jixiuf.github.io/blog/release.html";
          var disqus_shortname = 'jixiuf';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <div class="ds-thread"></div>
        <script type="text/javascript">
          var duoshuoQuery = {short_name:'jixiuf'};
          (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = 'http://static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
        </script>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script> -->
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x (<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:jixiuf &lt;at&gt; gmail &lt;dot&gt; com">纪秀峰</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
